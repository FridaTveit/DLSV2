@using DigitalLearningSolutions.Web.ViewModels.LearningPortal
@model CurrentViewModel.CurrentCourseViewModel

<div class="nhsuk-panel nhsuk-u-margin-top-3 nhsuk-u-margin-bottom-3">
  <h4 class="nhsuk-u-margin-bottom-1" id="@Model.Id-name">@Model.Name</h4>
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-three-quarters tags">
      @if (Model.UserIsSupervisor)
      {
        <div class="tag highlight-tag nhsuk-u-font-size-14" aria-describedby="@Model.Id-name">
          Supervisor
        </div>
      }
      @if (Model.HasDiagnosticAssessment)
      {
        <div class="tag nhsuk-u-font-size-14" aria-describedby="@Model.Id-name">
          Diagnostic assessment
        </div>
      }
      @if (Model.HasLearningContent)
      {
        <div class="tag nhsuk-u-font-size-14" aria-describedby="@Model.Id-name">
          Learning content
        </div>
      }
      @if (Model.HasLearningAssessmentAndCertification)
      {
        <div class="tag nhsuk-u-font-size-14" aria-describedby="@Model.Id-name">
          Learning assessment and certification
        </div>
      }
      @if (Model.IsEnrolledWithGroup)
      {
        <div class="tag nhsuk-u-font-size-14" aria-describedby="@Model.Id-name">
          In group
        </div>
      }

    </div>
  </div>
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-one-quarter">
      <h5 class="nhsuk-u-margin-bottom-2" id="@Model.Id-enrolled-title" aria-describedby="@Model.Id-name">Enrolled</h5>
      <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-2" />

      <p aria-describedby="@Model.Id-name @Model.Id-enrolled-title">@Model.StartedDate.ToShortDateString()</p>
    </div>
    <div class="nhsuk-grid-column-one-quarter">
      <h5 class="nhsuk-u-margin-bottom-2" id="@Model.Id-last-access-title" aria-describedby="@Model.Id-name">Last access</h5>
      <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-2" />

      <p aria-describedby="@Model.Id-name @Model.Id-last-access-title">@Model.LastAccessedDate.ToShortDateString()</p>
    </div>
    <div class="nhsuk-grid-row nhsuk-grid-column-one-half">
      <div class="nhsuk-grid-column-three-quarters">
        <h5 class="nhsuk-u-margin-bottom-2" id="@Model.Id-complete-by-title" aria-describedby="@Model.Id-name">Complete by</h5>
        <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-2" />
      </div>
      <div class="nhsuk-grid-column-one-half nhsuk-u-one-half">
        @{ var overdue = Model.Overdue() ? "overdue" : ""; }
        <p class="@overdue" aria-describedby="@Model.Id-name @Model.Id-complete-by-title">@(@Html.Raw(Model.CompleteByDate?.ToShortDateString() ?? "<span class='nhsuk-u-visually-hidden'>No complete by date set </span>-"))</p>
      </div>
      <div class="nhsuk-grid-column-one-half nhsuk-u-one-half">
        <a class="nhsuk-button nhsuk-button--secondary small-edit-button" aria-describedby="@Model.Id-name" aria-label="Edit complete by date" asp-action="SetCompleteByDate" asp-route-id="@Model.Id">
          Edit
        </a>
      </div>
    </div>
  </div>
  @if (@Model.HasDiagnosticScore() || @Model.HasPassedSections())
  {
    <div class="nhsuk-grid-row">
      @if (@Model.HasDiagnosticScore())
      {
        <div class="nhsuk-grid-column-one-quarter">
          <h5 class="nhsuk-u-margin-bottom-2" id="@Model.Id-diagnostic-score-title" aria-describedby="@Model.Id-name">Diagnostic Score</h5>
          <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-2" />
          <p aria-describedby="@Model.Id-name @Model.Id-diagnostic-score-title">@Model.DiagnosticScore</p>
        </div>
      }
      @if (@Model.HasPassedSections())
      {
        <div class="nhsuk-grid-column-one-quarter">
          <h5 class="nhsuk-u-margin-bottom-2" id="@Model.Id-passed-sections-title" aria-describedby="@Model.Id-name">Passed Sections</h5>
          <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-2" />
          <p aria-describedby="@Model.Id-name @Model.Id-passed-sections-title">@Model.DisplayPassedSections()</p>
        </div>
      }
    </div>
  }
  @if (@Model.IsLocked)
  {
    <hr />
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-one-half nhsuk-u-one-half">
        <p>You have reached the assessment limit for this course, and further assessment progress is now locked.</p>
      </div>
      <div class="nhsuk-grid-column-one-half nhsuk-u-one-half">
        <a class="nhsuk-button nhsuk-button--secondary small-edit-button" aria-describedby="@Model.Id-name" asp-action="RequestUnlock" asp-route-id="@Model.ProgressId">
          Request unlock
        </a>
      </div>
    </div>
    <hr />
  }
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <a class="nhsuk-button nhsuk-u-margin-bottom-0" aria-describedby="@Model.Id-name" href="@Model.LaunchUrl">
        Launch course
      </a>
      <a class="nhsuk-button delete-button nhsuk-u-margin-bottom-0" aria-describedby="@Model.Id-name" asp-action="RemoveCurrentCourseConfirmation" asp-route-id="@Model.Id">
        Remove course
      </a>
    </div>
  </div>
</div>
